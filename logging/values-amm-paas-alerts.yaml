kube-prometheus-stack:
  additionalPrometheusRulesMap:
    # AMM PAAS Metrics
    amm-paas:
      groups:
      - name: FSMDatabaseHealthy
        rules:
        - alert: FSMDatabaseHealthyCritical
          expr: ifsamm_fsm_db_health != 1
          for: 5m
          labels:
            severity: critical
          annotations:
            description: '{{$labels.instance}}: FSMDatabaseHealthyCritical is critical. (current value is: {{ $value }})'
            summary: '{{$labels.instance}}: FSMDatabaseHealthyCritical is critical'
            message: '{{$labels.instance}}_FSMDatabaseHealthyCritical'

      - name: FSMPerformanceMonitor
        rules:
        - alert: FSMPerformanceMonitorCritical
          expr: ifsamm_fsm_server_health != 1 or ifsamm_fsm_query_time > 1000 or ifsamm_fsm_server_info_time > 100
          for: 5m
          labels:
            severity: warning
          annotations:
            description: '{{$labels.instance}}: FSMPerformanceMonitorCritical is critical. (current value is: {{ $value }})'
            summary: '{{$labels.instance}}: FSMPerformanceMonitorCritical is critical'
            message: '{{$labels.instance}}_FSMPerformanceMonitorCritical'

      - name: FSMServerHealthy
        rules:
        - alert: FSMServerHealthyCritical
          expr: ifsamm_fsm_health_check_status != 200
          for: 4m
          labels:
            severity: critical
          annotations:
            description: '{{$labels.instance}}: FSMServerHealthyCritical is critical. (current value is: {{ $value }})'
            summary: '{{$labels.instance}}: FSMServerHealthyCritical is critical'
            message: '{{$labels.instance}}_FSMServerHealthyCritical'

      - name: FSMServerMobMonitor
        rules:
        - alert: FSMServerMobMonitorCritical
          expr: ifsamm_http_response{server=~".*mobilemonitor.*",ifsversion=~"fsm.*"} != 200
          for: 5m
          labels:
            severity: critical
          annotations:
            description: '{{$labels.instance}}: FSMServerMobMonitorCritical is critical. (current value is: {{ $value }})'
            summary: '{{$labels.instance}}: FSMServerMobMonitorCritical is critical'
            message: '{{$labels.instance}}_FSMServerMobMonitorCritical'

      - name: ifsamm_fsm_smart_client_logon
        rules:
        - alert: ifsamm_fsm_smart_client_logonCritical
          expr: ifsamm_fsm_smart_client_logon != 200
          for: 2m
          labels:
            severity: critical
          annotations:
            description: '{{$labels.instance}}: ifsamm_fsm_smart_client_logon is critical. (current value is: {{ $value }})'
            summary: '{{$labels.instance}}: Critical ifsamm_fsm_smart_client_logon'
            message: '{{$labels.instance}}_ifsamm_fsm_smart_client_logonCritical'

      - name: ifsamm_fsm_web_client_logon
        rules:
        - alert: ifsamm_fsm_web_client_logonCritical
          expr: ifsamm_fsm_web_client_logon != 200
          for: 5m
          labels:
            severity: critical
          annotations:
            description: '{{$labels.instance}}: ifsamm_fsm_web_client_logon is critical. (current value is: {{ $value }})'
            summary: '{{$labels.instance}}: Critical ifsamm_fsm_web_client_logon'
            message: '{{$labels.instance}}_ifsamm_fsm_web_client_logonCritical'

      - name: PSOtestMonitor
        rules:
        - alert: PSOtestMonitorCritical
          expr: ifsamm_pso_last_system_test_status != 0
          for: 5m
          labels:
            severity: critical
          annotations:
            description: '{{$labels.instance}}: PSOtestMonitorCritical is critical.'
            summary: '{{$labels.instance}}: PSOtestMonitorCritical is critical'
            message: '{{$labels.instance}}_PSOtestMonitorCritical'

      - name: SSLCertExpiration
        rules:
        - alert: SSLCertExpirationCritical
          expr: (ifsamm_http_cert <= 15 )
          for: 24h
          labels:
            severity: critical
          annotations:
            description: '{{$labels.instance}}: SSLCertExpiration is critical. (current value is: {{ $value }})'
            summary: '{{$labels.instance}}: Critical certificate time'
            message: '{{$labels.instance}}_SSLCertExpirationCritical'
        - alert: SSLCertExpirationWarning
          expr: ( ifsamm_http_cert > 15 ) AND ( ifsamm_http_cert <= 30 )
          for: 24h
          labels:
            severity: info
          annotations:
            description: '{{$labels.instance}}: SSLCertExpiration is warning. (current value is: {{ $value }})'
            summary: '{{$labels.instance}}: Warning certificate time'
            message: '{{$labels.instance}}_SSLCertExpirationWarning'

      - name: ifsAppAvailability
        rules:
        - alert: ifsAppAvailabilityWarning
          expr: (ifsamm_http_login != 200)
          for: 4m
          labels:
            severity: critical
          annotations:
            description: '{{$labels.instance}}: ifsAppAvailability is giving a critical warning. (current value is: {{ $value }})'
            summary: '{{$labels.instance}}: Availability critical warning'
            message: '{{$labels.instance}}_ifsAppAvailabilityWarning'

      - name: ifsAppAvailabilityReverseProxy
        rules:
        - alert: ifsAppAvailabilityReverseProxyCritical
          expr: (ifsamm_http_login != 200) AND (ifsamm_http_login != 401)
          for: 4m
          labels:
            severity: critical
          annotations:
            description: '{{$labels.instance}}: ifsAppAvailabilityReverseProxy is giving a critical warning. (current value is: {{ $value }})'
            summary: '{{$labels.instance}}: AvailabilityReverseProxy critical warning'
            message: '{{$labels.instance}}_ifsAppAvailabilityReverseProxyCritical'
        - alert: ifsAppAvailabilityReverseProxyWarning
          expr: ifsamm_http_login == 401
          for: 4m
          labels:
            severity: info
          annotations:
            description: '{{$labels.instance}}: ifsAppAvailabilityReverseProxy is giving a warning. (current value is: {{ $value }})'
            summary: '{{$labels.instance}}: AvailabilityReverseProxy warning'
            message: '{{$labels.instance}}_ifsAppAvailabilityReverseProxyWarning'

      - name: intServer
        rules:
        - alert: intServerDown
          expr: ifsamm_mws_healthstateid{mwsserver=~".*IntServer.*"} != 1
          for: 10m
          labels:
            severity: warning
          annotations:
            summary: 'IntServer in {{ $labels.instance }} is down - severity level {{ $labels.severity }}'
            description: 'IntServer in {{ $labels.instance }} is currenly unavailable for more than 10 minutes'
            message: '{{$labels.instance}}_intServerDown'

      - name:  ifsamm_mws_java_memory_usage_intServer
        rules:
        - alert: ifsamm_mws_java_memory_usage_intServerCritical
          expr: ifsamm_mws_java_memory_usage{mwsserver=~".*IntServer.*"} >= 90
          for: 10m
          labels:
            severity: warning
          annotations:
            summary: 'IntServer java memory usage is critical. (Current value is: {{$value}})'
            description: 'IntServer java memory usage is critical for more than 10 minutes'
            message: '{{$labels.instance}}_ifsamm_mws_java_memory_usage_intServerCritical'

      - name: ifsamm_mws_stuck_threads_intServer
        rules:
        - alert: ifsamm_mws_stuck_threads_intServerCritical
          expr: ifsamm_mws_stuck_threads{mwsserver=~".*IntServer.*"} >= 20
          for: 10m
          labels:
            severity: warning
          annotations:
            summary: 'IntServer stuck threads is critical. (Current value is: {{$value}})'
            description: 'IntServer stuck threads is critical for more than 10 minutes'
            message: '{{$labels.instance}}_ifsamm_mws_stuck_threads_intServerCritical'
        - alert: ifsamm_mws_stuck_threads_intServerWarning
          expr: (ifsamm_mws_stuck_threads{mwsserver=~".*IntServer.*"} >= 10) AND (ifsamm_mws_stuck_threads{mwsserver=~".*IntServer.*"} < 20)
          for: 10m
          labels:
            severity: warning
          annotations:
            summary: 'IntServer stuck threads is warning. (Current value is: {{$value}})'
            description: 'IntServer stuck threads is warning for more than 10 minutes'
            message: '{{$labels.instance}}_ifsamm_mws_stuck_threads_intServerWarning'

      - name: ifsamm_mws_applications_started_intServer
        rules:
        - alert: ifsamm_mws_applications_started_intServerCritical
          expr: ifsamm_mws_applications_started{mwsserver=~".*IntServer.*", mode!="Active"} > 0
          for: 10m
          labels:
            severity: info
          annotations:
            summary: 'IntServer applications started is critical. (Current value is: {{ $value }})'
            description: 'IntServer applications started is critical for more than 10 minutes'
            message: '{{$labels.instance}}_ifsamm_mws_applications_started_intServerCritical'

      - name: ifsamm_mws_java_memory_usage_mainServer
        rules:
        - alert: ifsamm_mws_java_memory_usage_mainServerCritical
          expr: ifsamm_mws_java_memory_usage{mwsserver=~".*MainServer.*"} >= 90
          for: 10m
          labels:
            severity: warning
          annotations:
            summary: 'MainServer java memory usage is critical. (Current value is: {{$value}})'
            description: 'MainServer java memory usage is critical for more than 10 minutes'
            message: '{{$labels.instance}}_ifsamm_mws_java_memory_usage_mainServerCritical'

      - name: mainServer
        rules:
        - alert: mainServerDown
          expr: ifsamm_mws_healthstateid{mwsserver=~".*MainServer.*"} != 1
          for: 10m
          labels:
            severity: critical
          annotations:
            summary: 'MainServer in {{ $labels.instance }} is down. (Current value is: {{ $value }})'
            description: 'MainServer in {{ $labels.instance }} is currenly unavailable for more than 10 minutes'
            message: '{{$labels.instance}}_mainServerDown'

      - name: ifsamm_mws_stuck_threads_MainServer
        rules:
        - alert: ifsamm_mws_stuck_threads_MainServerCritical
          expr: ( ifsamm_mws_stuck_threads{mwsserver=~".*MainServer.*"} >= 20 )
          for: 10m
          labels:
            severity: warning
          annotations:
            summary: 'MainServer stuck threads is critical. (Current value is: {{$value}})'
            description: 'MainServer stuck threads is critical for more than 10 minutes'
            message: '{{$labels.instance}}_ifsamm_mws_stuck_threads_MainServerCritical'
        - alert: ifsamm_mws_stuck_threads_MainServerWarning
          expr: (ifsamm_mws_stuck_threads{mwsserver=~".*MainServer.*"} >= 10) AND (ifsamm_mws_stuck_threads{mwsserver=~".*MainServer.*"} < 20)
          for: 10m
          labels:
            severity: info
          annotations:
            summary: 'MainServer stuck threads is warning. (Current value is: {{$value}})'
            description: 'MainServer stuck threads is warning for more than 10 minutes'
            message: '{{$labels.instance}}_ifsamm_mws_stuck_threads_MainServerWarning'

      - name: ifsamm_mws_fndbas_status_MainServer
        rules:
        - alert: ifsamm_mws_fndbas_status_mainServerCritical
          expr: ifsamm_mws_fndbas_status{mwsserver=~".*MainServer.*"} != 2
          for: 10m
          labels:
            severity: warning
          annotations:
            summary: 'MainServer fndbas status is critical {{ $labels.severity }}'
            description: 'MainServer fndbas status is critical for more than 10 minutes'
            message: '{{$labels.instance}}_ifsamm_mws_fndbas_status_MainServerCritical'

      - name: ifsamm_mws_fndbasxa_status_MainServer
        rules:
        - alert: ifsamm_mws_fndbasxa_status_mainServerCritical
          expr: ifsamm_mws_fndbasxa_status{mwsserver=~".*MainServer.*"} != 2
          for: 10m
          labels:
            severity: warning
          annotations:
            summary: 'MainServer fndbasxa status is critical. (Current value is: {{$value }})'
            description: 'MainServer fndbasxa status is critical for more than 10 minutes'
            message: '{{$labels.instance}}_ifsamm_mws_fndbasxa_status_mainServerCritical'

      - name: ifsamm_mws_applications_started_mainServer
        rules:
        - alert: ifsamm_mws_applications_started_mainServerCritical
          expr: ifsamm_mws_applications_started{mwsserver=~".*MainServer.*", mode!="Active"} > 0
          for: 10m
          labels:
            severity: info
          annotations:
            summary: 'MainServer applications started is critical. (Current value is: {{$value}})'
            description: 'MainServer applications started is critical for more than 10 minutes'
            message: '{{$labels.instance}}_ifsamm_mws_applications_started_mainServerCritical'

      # AMM HTTP response
      - name: HTTPFsmAppService
        rules:
        - alert: HTTPFsmAppServiceDown
          expr: ifsamm_http_response{server=~".*main.*"} != 200
          for: 5m
          labels:
            severity: warning
          annotations:
            description: 'HTTPFsmAppServiceDown is down'
            summary: 'HTTPFsmAppServiceDown is down.(current value is: {{$value}})'
            message: '{{$labels.instance}}_HTTPFsmAppServiceDown'

      - name: HTTPFsmCustomerPortal
        rules:
        - alert: HTTPCustomerPortalDown
          expr: ifsamm_http_response{server=~".*cp.*"} != 200
          for: 5m
          labels:
            severity: warning
          annotations:
            description: 'HTTPCustomerPortalDown is down.'
            summary: 'HTTPCustomerPortalDown is down.(current value is: {{$value}})'
            message: '{{$labels.instance}}_HTTPCustomerPortalDown'

      - name: HTTPFsmIntService
        rules:
        - alert: HTTPFsmIntServiceDown
          expr: ifsamm_http_response{server=~".*mis.*"} != 200
          for: 5m
          labels:
            severity: warning
          annotations:
            description: 'HTTPFsmIntServiceDown is down'
            summary: 'HTTPFsmIntServiceDown is down.(current value is: {{$value}})'
            message: '{{$labels.instance}}_HTTPFsmIntServiceDown'

      - name: HTTPFsmMobileService
        rules:
        - alert: HTTPFsmMobileServiceDown
          expr: ifsamm_http_response{server=~".*mobile.*"} != 200
          for: 5m
          labels:
            severity: warning
          annotations:
            description: 'HTTPFsmMobileServiceDown is down'
            summary: 'HTTPFsmMobileServiceDown is down.(current value is: {{$value}})'
            message: '{{$labels.instance}}_HTTPFsmMobileServiceDown'

      - name: HTTPFsmWarehousePortal
        rules:
        - alert: HTTPFsmWarehousePortalDown
          expr: ifsamm_http_response{server=~".*wp.*"} != 200
          for: 5m
          labels:
            severity: warning
          annotations:
            description: 'HTTPFsmWarehousePortalDown is down'
            summary: 'HTTPFsmWarehousePortalDown is down.(current value is: {{$value}})'
            message: '{{$labels.instance}}_HTTPFsmWarehousePortalDown'

      - name: HTTPFsmWebClient
        rules:
        - alert: HTTPFsmWebClientDown
          expr: ifsamm_http_response{server=~".*web.*"} != 200
          for: 5m
          labels:
            severity: warning
          annotations:
            description: 'HTTPFsmWebClientDown is down'
            summary: 'HTTPFsmWebClientDown is down.(current value is: {{$value}})'
            message: '{{$labels.instance}}_HTTPFsmWebClientDown'

      - name: HTTPPsoWorkbench
        rules:
        - alert: HTTPPsoWorkbenchDown
          expr: ifsamm_http_response{server=~".*ipwb.*"} != 200
          for: 5m
          labels:
            severity: critical
          annotations:
            description: 'HTTPPsoWorkbenchDown is down'
            summary: 'HTTPFsmPsoWorkbenchDown is down.(current value is: {{$value}})'
            message: '{{$labels.instance}}_HTTPFsmPsoWorkbenchDown'

      - name: HTTPSchedulingWorkbench
        rules:
        - alert: HTTPSchedulingWorkbenchDown
          expr: ifsamm_http_response{server=~".*iswb.*"} != 200
          for: 5m
          labels:
            severity: critical
          annotations:
            description: 'HTTPFsmSchedulingWorkbenchDown is down'
            summary: 'HTTPFsmSchedulingWorkbenchDown is down.(current value is: {{$value}})'
            message: '{{$labels.instance}}_HTTPFsmSchedulingWorkbenchDown'

      - name: HTTPAPPS10WebClientb2b
        rules:
        - alert: HTTPAPPS10WebClientb2bDown
          expr: ifsamm_http_response{server=~".*b2b10.*",ifsversion=~"apps10.*"} != 200
          for: 10m
          labels:
            severity: warning
          annotations:
            description: 'HTTPWAPPS10ebClientb2bDown is down'
            summary: 'HTTPAPPS10WebClientb2bDown is down.(current value is: {{$value}})'
            message: '{{$labels.instance}}_HTTPAPPS10WebClientb2bDown'

      - name: HTTPAPPS9WebClientb2b
        rules:
        - alert: HTTPAPPS9WebClientb2bDown
          expr: ifsamm_http_response{server=~".*b2b9.*",ifsversion=~"apps9.*"} != 200
          for: 10m
          labels:
            severity: warning
          annotations:
            description: 'HTTPWAPPS9webClientb2bDown is down'
            summary: 'HTTPAPPS9WebClientb2bDown is down.(current value is: {{$value}})'
            message: '{{$labels.instance}}_HTTPAPPS9WebClientb2bDown'

      - name: HTTPAPPS9WebClientb2e
        rules:
        - alert: HTTPAPPS9WebClientb2eAlert
          expr: ifsamm_http_response{server=~".*b2e9.*",ifsversion=~"apps9.*"} != 200
          for: 10m
          labels:
            severity: critical
          annotations:
            description: 'HTTPWAPPS9WebClientb2eDown is down'
            summary: 'HTTPAPPS9WebClientb2eDown is down.(current value is: {{$value}})'
            message: '{{$labels.instance}}_HTTPAPPS9WebClientb2eDown'

      - name: TASDatabaseSystemID
        rules:
        - alert: TASDatabaseSystemIDDown
          expr: ifsamm_http_response{server=~".*tas.*",ifsrole=~".*tas.*"} != 200
          for: 10m
          labels:
            severity: warning
          annotations:
            description: 'TASDatabaseSystemIDDown is down'
            summary: 'TASDatabaseSystemIDDown is down.(current value is: {{$value}})'
            message: '{{$labels.instance}}_TASDatabaseSystemIDDown'

      - name: IFSAppsElapsedtimeMonitor
        rules:
        - alert: IFSAppsElapsedtimeMonitorCritical
          expr: ifsamm_http_login_duration > 30000
          for: 10m
          labels:
            severity: warning
          annotations:
            description: 'IFSAppsElapsedtimeMonitorCritical has reached critical level.'
            summary: 'IFSAppsElapsedtimeMonitorCritical has reached critical level. (current value is: {{$value}})'
            message: '{{$labels.instance}}_IFSAppsElapsedtimeMonitorCritical'
        - alert: IFSAppsElapsedtimeMonitorWarning
          expr: (ifsamm_http_login_duration > 10000) and (ifsamm_http_login_duration <= 30000)
          for: 10m
          labels:
            severity: debug
          annotations:
            description: 'IFSAppsElapsedtimeMonitorWarning has reached warning level.'
            summary: 'IFSAppsElapsedtimeMonitorWarning has reached warning level. (current value is: {{$value}})'
            message: '{{$labels.instance}}_IFSAppsElapsedtimeMonitorWarning'

      - name: AMMservice
        rules:
        - alert: AMMServiceDown
          expr: windows_service_state{name=~"AMM.*",state="running"} != 1
          for: 10m
          labels:
            severity: critical
          annotations:
            description: 'AMM service in {{ $labels.instance }} is currently unavailable for more than 10 minutes'
            summary: 'AMM service in {{ $labels.instance }} down - severity level 1. (Current value is: {{$value}})'
            message: '{{$labels.instance}}_AMMServiceDown'
